(function(){"use strict";var a;a=function(a,b){var c,d,e,f,g=this;return this.options=$.extend({gallery_parent_selector:"*:not(.row)",title:null,footer:null,remote:null,left_arrow_class:".glyphicon .glyphicon-chevron-left",right_arrow_class:".glyphicon .glyphicon-chevron-right",directional_arrows:!0,type:null,onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){},id:!1},b||{}),this.$element=$(a),c="",this.modal_id=this.options.modal_id?this.options.modal_id:"ekkoLightbox-"+Math.floor(1e3*Math.random()+1),e='<div class="modal-header"'+(this.options.title?"":' style="display:none"')+'><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+this.options.title+"</h4></div>",d='<div class="modal-footer"'+(this.options.footer?"":' style="display:none"')+">"+this.options.footer+"</div>",$(document.body).append('<div id="'+this.modal_id+'" class="ekko-lightbox modal fade" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+e+'<div class="modal-body"><div class="ekko-lightbox-container"><div></div></div></div>'+d+"</div></div></div>"),this.modal=$("#"+this.modal_id),this.modal_body=this.modal.find(".modal-body").first(),this.lightbox_container=this.modal_body.find(".ekko-lightbox-container").first(),this.lightbox_body=this.lightbox_container.find("> div:first-child").first(),this.modal_arrows=null,this.padding={left:parseFloat(this.modal_body.css("padding-left"),10),right:parseFloat(this.modal_body.css("padding-right"),10),bottom:parseFloat(this.modal_body.css("padding-bottom"),10),top:parseFloat(this.modal_body.css("padding-top"),10)},this.options.remote?(this.gallery=this.$element.data("gallery"),this.gallery&&(this.gallery_items="document.body"===this.options.gallery_parent_selector||""===this.options.gallery_parent_selector?$(document.body).find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]'):this.$element.parents(this.options.gallery_parent_selector).first().find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]'),this.gallery_index=this.gallery_items.index(this.$element),$(document).on("keydown.ekkoLightbox",this.navigate.bind(this)),this.options.directional_arrows&&this.gallery_items.length>1&&(this.lightbox_container.prepend('<div class="ekko-lightbox-nav-overlay"><a href="#" class="'+this.strip_stops(this.options.left_arrow_class)+'"></a><a href="#" class="'+this.strip_stops(this.options.right_arrow_class)+'"></a></div>'),this.modal_arrows=this.lightbox_container.find("div.ekko-lightbox-nav-overlay").first(),this.lightbox_container.find("a"+this.strip_spaces(this.options.left_arrow_class)).on("click",function(a){return a.preventDefault(),g.navigate_left()}),this.lightbox_container.find("a"+this.strip_spaces(this.options.right_arrow_class)).on("click",function(a){return a.preventDefault(),g.navigate_right()}))),this.options.type?"image"===this.options.type?this.preloadImage(this.options.remote,!0):"youtube"===this.options.type&&(f=this.getYoutubeId(this.options.remote))?this.showYoutubeVideo(f):"vimeo"===this.options.type?this.showVimeoVideo(this.options.remote):this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"'):this.detectRemoteType(this.options.remote)):this.error("No remote target given"),this.modal.on("show.bs.modal",this.options.onShow.bind(this)).on("shown.bs.modal",function(){return g.modal_arrows&&g.resize(g.lightbox_body.width()),g.options.onShown.call(g)}).on("hide.bs.modal",this.options.onHide.bind(this)).on("hidden.bs.modal",function(){return g.gallery&&$(document).off("keydown.ekkoLightbox"),g.modal.remove(),g.options.onHidden.call(g)}).modal("show",b),this.modal},a.prototype={strip_stops:function(a){return a.replace(/\./g,"")},strip_spaces:function(a){return a.replace(/\s/g,"")},isImage:function(a){return a.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSwf:function(a){return a.match(/\.(swf)((\?|#).*)?$/i)},getYoutubeId:function(a){var b;return b=a.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/),b&&11===b[2].length?b[2]:!1},getVimeoId:function(a){return a.indexOf("vimeo")>0?a:!1},navigate:function(a){if(a=a||window.event,39===a.keyCode||37===a.keyCode){if(39===a.keyCode)return this.navigate_right();if(37===a.keyCode)return this.navigate_left()}},navigate_left:function(){var a;if(1!==this.gallery_items.length)return 0===this.gallery_index?this.gallery_index=this.gallery_items.length-1:this.gallery_index--,this.$element=$(this.gallery_items.get(this.gallery_index)),this.updateTitleAndFooter(),a=this.$element.attr("data-remote")||this.$element.attr("href"),this.detectRemoteType(a,this.$element.attr("data-type"))},navigate_right:function(){var a,b;if(1!==this.gallery_items.length)return this.gallery_index===this.gallery_items.length-1?this.gallery_index=0:this.gallery_index++,this.$element=$(this.gallery_items.get(this.gallery_index)),b=this.$element.attr("data-remote")||this.$element.attr("href"),this.updateTitleAndFooter(),this.detectRemoteType(b,this.$element.attr("data-type")),this.gallery_index+1<this.gallery_items.length&&(a=$(this.gallery_items.get(this.gallery_index+1),!1),b=a.attr("data-remote")||a.attr("href"),"image"===a.attr("data-type")||this.isImage(b))?this.preloadImage(b,!1):void 0},detectRemoteType:function(a,b){var c;return"image"===b||this.isImage(a)?this.preloadImage(a,!0):"youtube"===b||(c=this.getYoutubeId(a))?this.showYoutubeVideo(c):"vimeo"===b||(c=this.getVimeoId(a))?this.showVimeoVideo(c):this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"')},updateTitleAndFooter:function(){var a,b,c,d;return c=this.modal.find(".modal-dialog .modal-content .modal-header"),b=this.modal.find(".modal-dialog .modal-content .modal-footer"),d=this.$element.data("title")||"",a=this.$element.data("footer")||"",d?c.css("display","").find(".modal-title").html(d):c.css("display","none"),a?b.css("display","").html(a):b.css("display","none"),this},showLoading:function(){return this.lightbox_body.html('<div class="modal-loading">Loading..</div>'),this},showYoutubeVideo:function(a){var b,c;return c=this.$element.data("width")||560,b=this.$element.data("height")||315,this.resize(c),this.lightbox_body.html('<iframe width="'+c+'" height="'+b+'" src="//www.youtube.com/embed/'+a+'?badge=0&autoplay=1&html5=1" frameborder="0" allowfullscreen></iframe>'),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},showVimeoVideo:function(a){return this.resize(500),this.lightbox_body.html('<iframe width="500" height="281" src="'+a+'?autoplay=1" frameborder="0" allowfullscreen></iframe>'),this.modal_arrows?this.modal_arrows.css("display","none"):void 0},error:function(a){return this.lightbox_body.html(a),this},preloadImage:function(a,b){var c,d=this;return c=new Image,(null==b||b===!0)&&(c.onload=function(){var a,b;return b=d.checkImageDimensions(c.width),a=$("<img />"),a.attr("src",c.src),a.css("max-width","100%"),d.lightbox_body.html(a),d.modal_arrows&&d.modal_arrows.css("display","block"),d.resize(b)},c.onerror=function(){return d.error("Failed to load image: "+a)}),c.src=a,c},resize:function(a){var b;return b=a+this.padding.left+this.padding.right,this.modal.find(".modal-content").css("width",b),this.modal.find(".modal-dialog").css("width",b+20),this.lightbox_container.find("a").css("padding-top",function(){return $(this).parent().height()/2}),this},checkImageDimensions:function(a){var b,c;return b=$(window),c=a,a+(this.padding.left+this.padding.right+20)>b.width()&&(c=b.width()-(this.padding.left+this.padding.right+20)),c},close:function(){return this.modal.modal("hide")}},$.fn.ekkoLightbox=function(b){return this.each(function(){var c;return c=$(this),b=$.extend({remote:c.attr("data-remote")||c.attr("href"),gallery_parent_selector:c.attr("data-parent"),type:c.attr("data-type")},b,c.data()),new a(this,b),this})}}).call(this);